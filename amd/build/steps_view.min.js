define(["jquery","core/ajax","core/notification","core/str"],function($,ajax,notification,str){var confetti_toogle=!1,step_string="Step ",achievement_string="Achviement! ";$(".next-btn").on("click",function(){ajax.call([{methodname:"block_onboarding_next_step",args:{}}])[0].done(function(response){1==response.completed?$(".step-completed").css("visibility","visible"):$(".step-completed").css("visibility","hidden"),1==response.achievement?($(".step-title").text(achievement_string+response.name),confetti_toogle=!0,confetti()):($(".step-title").text(step_string+response.position+": "+response.name),confetti_toogle=!1),$(".step_description").text(response.description),$(".progress-bar-value").text(response.progress+"%"),$(".progress-bar-fill").css("width",response.progress+"%")}).fail(notification.exception)}),$(".skip-btn").on("click",function(){ajax.call([{methodname:"block_onboarding_skip_step",args:{}}])[0].done(function(response){1==response.completed?$(".step-completed").css("visibility","visible"):$(".step-completed").css("visibility","hidden"),1==response.achievement?($(".step-title").text("Achievement! "+response.name),confetti_toogle=!0,confetti()):($(".step-title").text("Step "+response.position+": "+response.name),confetti_toogle=!1),$(".step_description").text(response.description)}).fail(notification.exception)}),$(".back-btn").on("click",function(){ajax.call([{methodname:"block_onboarding_back_step",args:{}}])[0].done(function(response){1==response.completed?$(".step-completed").css("visibility","visible"):$(".step-completed").css("visibility","hidden"),1==response.achievement?($(".step-title").text(achievement_string+response.name),confetti_toogle=!0,confetti()):($(".step-title").text(step_string+response.position+": "+response.name),confetti_toogle=!1),$(".step_description").text(response.description)}).fail(notification.exception)});var confetti=function(){let achievement_canvas=document.getElementById("achievement-confetti");achievement_canvas.width=document.getElementById("achievement-confetti").offsetWidth,achievement_canvas.height=document.getElementById("achievement-confetti").offsetHeight;let context=achievement_canvas.getContext("2d"),particle=[],number_of_particles=45,lastUpdateTime=Date.now();function Particle(x,colors){this.x=x,this.y=colors,this.size=15*(.5*Math.random()+.75),this.gravity=.1*(.5*Math.random()+.75),this.rotation=2*Math.PI*Math.random(),this.rotationSpeed=2*Math.PI*(Math.random()-.5)*.001,this.color=(colors=["#f00","#0f0","#00f","#0ff","#f0f","#ff0"])[Math.floor(Math.random()*colors.length)]}for(;particle.length<number_of_particles&&1==confetti_toogle;)particle.push(new Particle(Math.random()*achievement_canvas.width,Math.random()*achievement_canvas.height));!function update(){var now=Date.now(),dif=now-lastUpdateTime;for(let i=particle.length-1;0<=i;i--){let p=particle[i];p.y>achievement_canvas.height?particle.splice(i,1):(p.y+=p.gravity*dif,p.rotation+=p.rotationSpeed*dif)}for(;particle.length<number_of_particles&&1==confetti_toogle;)particle.push(new Particle(Math.random()*achievement_canvas.width,-20));lastUpdateTime=now,setTimeout(update,1)}(),function draw(){context.clearRect(0,0,achievement_canvas.width,achievement_canvas.height),particle.forEach(function(p){context.save(),context.fillStyle=p.color,context.translate(p.x+p.size/2,p.y+p.size/2),context.rotate(p.rotation),context.fillRect(-p.size/2,-p.size/2,p.size,p.size),context.restore()}),requestAnimationFrame(draw)}()};return{init:function(){var step_promise=str.get_string("step_step_js","block_onboarding"),achievement_promise=str.get_string("step_achievement_js","block_onboarding");$.when(step_promise,achievement_promise).done(function(step_promise_string,achievement_promise_string){step_string=step_promise_string,achievement_string=achievement_promise_string,ajax.call([{methodname:"block_onboarding_init_step",args:{}}])[0].done(function(response){1==response.completed?$(".step-completed").css("visibility","visible"):$(".step-completed").css("visibility","hidden"),1==response.achievement?($(".step-title").text(achievement_string+response.name),confetti_toogle=!0,confetti()):$(".step-title").text(step_string+response.position+": "+response.name),$(".step_description").text(response.description),$(".progress-bar-value").text(response.progress+"%"),$(".progress-bar-fill").css("width",response.progress+"%")}).fail(notification.exception)})}}});