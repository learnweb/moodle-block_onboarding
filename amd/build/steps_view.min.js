define(["jquery","core/ajax","core/notification","core/str"],function($,ajax,notification,str){var confetti_toogle=!1,step_string="Step ",achievement_string="Achviement! ",reset_message_string="Do you really want to reset your progress?\nAll progress will be lost permanently.";$(".next-btn").on("click",function(){ajax.call([{methodname:"block_onboarding_next_step",args:{}}])[0].done(function(response){2==response.completed?($(".step-completed").css("visibility","visible"),$(".next-btn").css("display","none"),$(".reset-btn").css("visibility","visible")):1==response.completed?$(".step-completed").css("visibility","visible"):$(".step-completed").css("visibility","hidden"),1==response.achievement?($(".step-title").text(achievement_string+response.name),confetti_toogle=!0,confetti(),setTimeout(function(){confetti_toogle=!1},4e3)):($(".step-title").text(step_string+response.position+": "+response.name),confetti_toogle=!1),$(".step_description").text(response.description),$(".progress-bar-value").text(response.progress+"%"),$(".progress-bar-fill").css("width",response.progress+"%")}).fail(notification.exception)}),$(".back-btn").on("click",function(){ajax.call([{methodname:"block_onboarding_preceding_step",args:{}}])[0].done(function(response){$(".reset-btn").css("visibility","hidden"),$(".next-btn").css("display","inline"),1==response.completed||2==response.completed?$(".step-completed").css("visibility","visible"):$(".step-completed").css("visibility","hidden"),1==response.achievement?($(".step-title").text(achievement_string+response.name),confetti_toogle=!0,confetti(),setTimeout(function(){confetti_toogle=!1},4e3)):($(".step-title").text(step_string+response.position+": "+response.name),confetti_toogle=!1),$(".step_description").text(response.description)}).fail(notification.exception)}),$(".reset-btn").on("click",function(){1==confirm(reset_message_string)&&ajax.call([{methodname:"block_onboarding_reset_progress",args:{}}])[0].done(function(response){return location.reload(),!1}).fail(notification.exception)}),$(".hide-btn").on("click",function(){ajax.call([{methodname:"block_onboarding_toggle_visibility",args:{visibility:0}}])[0].done(function(response){$(".hide-btn").css("display","none"),$(".show-btn").css("display","inline"),$(".steps-container").css("display","none")}).fail(notification.exception)}),$(".show-btn").on("click",function(){ajax.call([{methodname:"block_onboarding_toggle_visibility",args:{visibility:1}}])[0].done(function(response){$(".hide-btn").css("display","inline"),$(".show-btn").css("display","none"),$(".steps-container").css("display","block")}).fail(notification.exception)});var confetti=function(){let achievement_canvas=document.getElementById("achievement-confetti");achievement_canvas.width=document.getElementById("achievement-confetti").offsetWidth,achievement_canvas.height=document.getElementById("achievement-confetti").offsetHeight;let context=achievement_canvas.getContext("2d"),particle=[],number_of_particles=45,lastUpdateTime=Date.now();function Particle(x,colors){this.x=x,this.y=colors,this.size=15*(.5*Math.random()+.75),this.gravity=.1*(.5*Math.random()+.75),this.rotation=2*Math.PI*Math.random(),this.rotationSpeed=2*Math.PI*(Math.random()-.5)*.001,this.color=(colors=["#f00","#0f0","#00f","#0ff","#f0f","#ff0"])[Math.floor(Math.random()*colors.length)]}for(;particle.length<number_of_particles&&1==confetti_toogle;)particle.push(new Particle(Math.random()*achievement_canvas.width,Math.random()*achievement_canvas.height));!function update(){var now=Date.now(),dif=now-lastUpdateTime;for(let i=particle.length-1;0<=i;i--){let p=particle[i];p.y>achievement_canvas.height?particle.splice(i,1):(p.y+=p.gravity*dif,p.rotation+=p.rotationSpeed*dif)}for(;particle.length<number_of_particles&&1==confetti_toogle;)particle.push(new Particle(Math.random()*achievement_canvas.width,-20));lastUpdateTime=now,setTimeout(update,1)}(),function draw(){context.clearRect(0,0,achievement_canvas.width,achievement_canvas.height),particle.forEach(function(p){context.save(),context.fillStyle=p.color,context.translate(p.x+p.size/2,p.y+p.size/2),context.rotate(p.rotation),context.fillRect(-p.size/2,-p.size/2,p.size,p.size),context.restore()}),requestAnimationFrame(draw)}()};return{init:function(){var step_promise=str.get_string("step_step_js","block_onboarding"),achievement_promise=str.get_string("step_achievement_js","block_onboarding"),reset_message_promise=str.get_string("button_reset_message_js","block_onboarding");$.when(step_promise,achievement_promise,reset_message_promise).done(function(step_promise_string,achievement_promise_string,reset_message_promise_string){step_string=step_promise_string,achievement_string=achievement_promise_string,reset_message_string=reset_message_promise_string,ajax.call([{methodname:"block_onboarding_init_step",args:{}}])[0].done(function(response){0==response.visibility?$(".show-btn").css("display","inline"):(1==response.visibility&&$(".hide-btn").css("display","inline"),$(".steps-container").css("display","block")),2==response.completed?($(".step-completed").css("visibility","visible"),$(".next-btn").css("display","none"),$(".reset-btn").css("visibility","visible")):1==response.completed?$(".step-completed").css("visibility","visible"):$(".step-completed").css("visibility","hidden"),1==response.achievement?($(".step-title").text(achievement_string+response.name),confetti_toogle=!0,confetti(),setTimeout(function(){confetti_toogle=!1},4e3)):$(".step-title").text(step_string+response.position+": "+response.name),$(".step_description").text(response.description),$(".progress-bar-value").text(response.progress+"%"),$(".progress-bar-fill").css("width",response.progress+"%")}).fail(notification.exception)})}}});